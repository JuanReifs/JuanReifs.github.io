<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitTracker Pro</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@400;600;700&family=Source+Sans+Pro:wght@400;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #ff4500;
            --primary-dark: #cc3700;
            --secondary: #00d4ff;
            --dark: #0a0e27;
            --dark-light: #1a1f3a;
            --text: #e0e0e0;
            --text-muted: #8a8a8a;
            --success: #00ff88;
            --warning: #ffaa00;
            --danger: #ff3366;
        }
        
        body {
            font-family: 'Source Sans Pro', sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, #0d1128 100%);
            color: var(--text);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255, 69, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 212, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }
        
        header {
            text-align: center;
            padding: 40px 0;
            margin-bottom: 30px;
            position: relative;
        }
        
        h1 {
            font-family: 'Oswald', sans-serif;
            font-size: 4rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 10px;
            animation: slideDown 0.8s ease-out;
        }
        
        .tagline {
            color: var(--text-muted);
            font-size: 1.1rem;
            letter-spacing: 2px;
            text-transform: uppercase;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: var(--dark-light);
            padding: 10px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        
        .tab {
            flex: 1;
            padding: 18px 25px;
            background: transparent;
            border: 2px solid transparent;
            color: var(--text-muted);
            font-family: 'Oswald', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 69, 0, 0.3), transparent);
            transition: left 0.5s ease;
        }
        
        .tab:hover::before {
            left: 100%;
        }
        
        .tab:hover {
            color: var(--primary);
            border-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .tab.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 5px 20px rgba(255, 69, 0, 0.4);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .card {
            background: var(--dark-light);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 69, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(255, 69, 0, 0.3);
        }
        
        h2 {
            font-family: 'Oswald', sans-serif;
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 10px;
        }
        
        h3 {
            font-family: 'Oswald', sans-serif;
            font-size: 1.5rem;
            color: var(--secondary);
            margin-bottom: 15px;
            text-transform: uppercase;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: var(--text);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 1px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            background: var(--dark);
            border: 2px solid rgba(255, 69, 0, 0.3);
            border-radius: 8px;
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(255, 69, 0, 0.3);
        }
        
        button {
            padding: 12px 30px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border: none;
            border-radius: 8px;
            color: white;
            font-family: 'Oswald', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 69, 0, 0.3);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 69, 0, 0.5);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary) 0%, #0099cc 100%);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.3);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.5);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #cc0033 100%);
            box-shadow: 0 5px 15px rgba(255, 51, 102, 0.3);
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        
        .btn-small {
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: rgba(255, 69, 0, 0.1);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid var(--primary);
            text-align: center;
        }
        
        .stat-value {
            font-family: 'Oswald', sans-serif;
            font-size: 2.5rem;
            color: var(--primary);
            font-weight: 700;
        }
        
        .stat-label {
            color: var(--text-muted);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 5px;
        }
        
        .item-list {
            margin-top: 20px;
        }
        
        .item {
            background: var(--dark);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
        }
        
        .item:hover {
            transform: translateX(5px);
            background: rgba(255, 69, 0, 0.1);
        }
        
        .item-info {
            flex: 1;
        }
        
        .item-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .item-details {
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        
        .item-actions {
            display: flex;
            gap: 10px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--dark-light);
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 2px solid var(--primary);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            animation: slideUp 0.4s ease;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close-modal {
            background: var(--danger);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .close-modal:hover {
            transform: rotate(90deg);
        }
        
        .amazon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .amazon-product {
            background: var(--dark);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid rgba(0, 212, 255, 0.3);
            transition: all 0.3s ease;
            text-decoration: none;
            color: var(--text);
            display: block;
        }
        
        .amazon-product:hover {
            border-color: var(--secondary);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.3);
        }
        
        .amazon-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .amazon-product h4 {
            color: var(--secondary);
            margin-bottom: 10px;
            font-family: 'Oswald', sans-serif;
        }
        
        .meal-log {
            background: var(--dark);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid var(--success);
        }
        
        .exercise-set {
            background: rgba(0, 212, 255, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
            border-left: 3px solid var(--secondary);
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .calorie-progress {
            width: 100%;
            height: 30px;
            background: var(--dark);
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
            border: 2px solid var(--primary);
        }
        
        .calorie-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--success) 0%, var(--primary) 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .grid-2, .stats-grid, .amazon-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>FitTracker Pro</h1>
            <p class="tagline">Tu compa√±ero definitivo de fitness</p>
        </header>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('calories')">üî• Calor√≠as</button>
            <button class="tab" onclick="switchTab('workouts')">üí™ Entrenamientos</button>
            <button class="tab" onclick="switchTab('recommendations')">üõçÔ∏è Recomendaciones</button>
        </div>
        
        <!-- TAB 1: CALOR√çAS -->
        <div id="calories-tab" class="tab-content active">
            <div class="card">
                <h2>Calculadora de Calor√≠as</h2>
                <div class="grid-2">
                    <div>
                        <div class="form-group">
                            <label>Edad</label>
                            <input type="number" id="age" placeholder="A√±os">
                        </div>
                        <div class="form-group">
                            <label>Peso (kg)</label>
                            <input type="number" id="weight" placeholder="Kilogramos">
                        </div>
                        <div class="form-group">
                            <label>Altura (cm)</label>
                            <input type="number" id="height" placeholder="Cent√≠metros">
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label>Sexo</label>
                            <select id="gender">
                                <option value="male">Masculino</option>
                                <option value="female">Femenino</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nivel de Actividad</label>
                            <select id="activity">
                                <option value="1.2">Sedentario</option>
                                <option value="1.375">Ligero (1-3 d√≠as/semana)</option>
                                <option value="1.55">Moderado (3-5 d√≠as/semana)</option>
                                <option value="1.725">Activo (6-7 d√≠as/semana)</option>
                                <option value="1.9">Muy Activo (2 veces al d√≠a)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Objetivo</label>
                            <select id="goal">
                                <option value="-500">Perder Peso (-500 cal)</option>
                                <option value="0">Mantener Peso</option>
                                <option value="500">Ganar Peso (+500 cal)</option>
                            </select>
                        </div>
                    </div>
                </div>
                <button onclick="calculateCalories()">Calcular Necesidades Cal√≥ricas</button>
                
                <div id="calorie-results" style="display: none; margin-top: 20px;">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="bmr-value">0</div>
                            <div class="stat-label">TMB (Metabolismo Basal)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="tdee-value">0</div>
                            <div class="stat-label">TDEE (Gasto Total)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="target-value">0</div>
                            <div class="stat-label">Objetivo Diario</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>Registro Diario de Comidas</h2>
                <div class="calorie-progress">
                    <div class="calorie-progress-bar" id="calorie-bar" style="width: 0%">
                        <span id="consumed-calories">0</span> / <span id="target-calories">0</span> cal
                    </div>
                </div>
                
                <div style="margin: 20px 0;">
                    <button onclick="openModal('add-meal-modal')">‚ûï A√±adir Comida</button>
                    <button class="btn-secondary" onclick="openModal('create-food-modal')">ü•ó Crear Alimento</button>
                    <button class="btn-secondary" onclick="openModal('create-recipe-modal')">üç≥ Crear Receta</button>
                </div>
                
                <div id="meals-log" class="item-list"></div>
            </div>
        </div>
        
        <!-- TAB 2: ENTRENAMIENTOS -->
        <div id="workouts-tab" class="tab-content">
            <div class="card">
                <h2>Mis Rutinas</h2>
                <button onclick="openModal('create-routine-modal')">‚ûï Crear Rutina</button>
                <div id="routines-list" class="item-list"></div>
            </div>
        </div>
        
        <!-- TAB 3: RECOMENDACIONES -->
        <div id="recommendations-tab" class="tab-content">
            <div class="card">
                <h2>Productos Fitness M√°s Vendidos en Amazon</h2>
                <p style="color: var(--text-muted); margin-bottom: 20px;">
                    Descubre los mejores productos de fitness y deporte disponibles en Amazon Espa√±a
                </p>
                <div class="amazon-grid" id="amazon-products"></div>
            </div>
        </div>
    </div>
    
    <!-- MODALES -->
    
    <!-- Modal: A√±adir Comida -->
    <div id="add-meal-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>A√±adir Comida al Registro</h3>
                <div class="close-modal" onclick="closeModal('add-meal-modal')">√ó</div>
            </div>
            <div class="form-group">
                <label>Seleccionar Alimento o Receta</label>
                <select id="meal-select">
                    <option value="">-- Selecciona --</option>
                </select>
            </div>
            <div class="form-group">
                <label>Cantidad (porciones)</label>
                <input type="number" id="meal-quantity" value="1" min="0.1" step="0.1">
            </div>
            <button onclick="addMealToLog()">A√±adir al Registro</button>
        </div>
    </div>
    
    <!-- Modal: Crear Alimento -->
    <div id="create-food-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Crear Nuevo Alimento</h3>
                <div class="close-modal" onclick="closeModal('create-food-modal')">√ó</div>
            </div>
            <div class="form-group">
                <label>Nombre del Alimento</label>
                <input type="text" id="food-name" placeholder="Ej: Pechuga de pollo">
            </div>
            <div class="form-group">
                <label>Prote√≠nas (g por 100g)</label>
                <input type="number" id="food-protein" placeholder="Gramos">
            </div>
            <div class="form-group">
                <label>Carbohidratos (g por 100g)</label>
                <input type="number" id="food-carbs" placeholder="Gramos">
            </div>
            <div class="form-group">
                <label>Grasas (g por 100g)</label>
                <input type="number" id="food-fats" placeholder="Gramos">
            </div>
            <button onclick="createFood()">Guardar Alimento</button>
        </div>
    </div>
    
    <!-- Modal: Crear Receta -->
    <div id="create-recipe-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Crear Nueva Receta</h3>
                <div class="close-modal" onclick="closeModal('create-recipe-modal')">√ó</div>
            </div>
            <div class="form-group">
                <label>Nombre de la Receta</label>
                <input type="text" id="recipe-name" placeholder="Ej: Ensalada de pollo">
            </div>
            <div class="form-group">
                <label>Porciones que produce</label>
                <input type="number" id="recipe-servings" value="1" min="1">
            </div>
            <h4 style="color: var(--secondary); margin: 20px 0 10px 0;">Ingredientes</h4>
            <div id="recipe-ingredients-list"></div>
            <button class="btn-secondary btn-small" onclick="addRecipeIngredient()">+ A√±adir Ingrediente</button>
            <br><br>
            <button onclick="createRecipe()">Guardar Receta</button>
        </div>
    </div>
    
    <!-- Modal: Crear Rutina -->
    <div id="create-routine-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Crear Nueva Rutina</h3>
                <div class="close-modal" onclick="closeModal('create-routine-modal')">√ó</div>
            </div>
            <div class="form-group">
                <label>Nombre de la Rutina</label>
                <input type="text" id="routine-name" placeholder="Ej: Rutina de Pecho">
            </div>
            <h4 style="color: var(--secondary); margin: 20px 0 10px 0;">Ejercicios</h4>
            <div id="routine-exercises-list"></div>
            <button class="btn-secondary btn-small" onclick="addExerciseToRoutine()">+ A√±adir Ejercicio</button>
            <br><br>
            <button onclick="createRoutine()">Guardar Rutina</button>
        </div>
    </div>
    
    <!-- Modal: Crear Ejercicio Personalizado -->
    <div id="create-exercise-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Crear Ejercicio Personalizado</h3>
                <div class="close-modal" onclick="closeModal('create-exercise-modal')">√ó</div>
            </div>
            <div class="form-group">
                <label>Nombre del Ejercicio</label>
                <input type="text" id="custom-exercise-name" placeholder="Ej: Plancha lateral">
            </div>
            <div class="form-group">
                <label>Unidad de Medida</label>
                <input type="text" id="custom-exercise-unit" placeholder="Ej: segundos, metros, etc.">
            </div>
            <button onclick="createCustomExercise()">Crear Ejercicio</button>
        </div>
    </div>
    
    <!-- Modal: Ver/Editar Rutina -->
    <div id="view-routine-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="view-routine-title">Rutina</h3>
                <div class="close-modal" onclick="closeModal('view-routine-modal')">√ó</div>
            </div>
            <div id="view-routine-content"></div>
        </div>
    </div>

    <script>
        // ==================== SISTEMA DE ALMACENAMIENTO ====================
        
        const Storage = {
            get: (key) => JSON.parse(localStorage.getItem(key) || '[]'),
            set: (key, value) => localStorage.setItem(key, JSON.stringify(value)),
            
            // Usuarios y Calor√≠as
            getUserData: () => JSON.parse(localStorage.getItem('userData') || '{}'),
            setUserData: (data) => localStorage.setItem('userData', JSON.stringify(data)),
            
            // Alimentos
            getFoods: () => Storage.get('foods'),
            addFood: (food) => {
                const foods = Storage.getFoods();
                foods.push({ id: Date.now(), ...food });
                Storage.set('foods', foods);
            },
            
            // Recetas
            getRecipes: () => Storage.get('recipes'),
            addRecipe: (recipe) => {
                const recipes = Storage.getRecipes();
                recipes.push({ id: Date.now(), ...recipe });
                Storage.set('recipes', recipes);
            },
            
            // Registro de comidas diarias
            getMeals: () => Storage.get('mealsToday'),
            addMeal: (meal) => {
                const meals = Storage.getMeals();
                meals.push({ id: Date.now(), ...meal });
                Storage.set('mealsToday', meals);
            },
            deleteMeal: (id) => {
                const meals = Storage.getMeals().filter(m => m.id !== id);
                Storage.set('mealsToday', meals);
            },
            
            // Ejercicios personalizados
            getCustomExercises: () => Storage.get('customExercises'),
            addCustomExercise: (exercise) => {
                const exercises = Storage.getCustomExercises();
                exercises.push({ id: Date.now(), ...exercise, isCustom: true });
                Storage.set('customExercises', exercises);
            },
            
            // Rutinas
            getRoutines: () => Storage.get('routines'),
            addRoutine: (routine) => {
                const routines = Storage.getRoutines();
                routines.push({ id: Date.now(), ...routine });
                Storage.set('routines', routines);
            },
            updateRoutine: (id, updatedRoutine) => {
                const routines = Storage.getRoutines();
                const index = routines.findIndex(r => r.id === id);
                if (index !== -1) {
                    routines[index] = { ...routines[index], ...updatedRoutine };
                    Storage.set('routines', routines);
                }
            },
            deleteRoutine: (id) => {
                const routines = Storage.getRoutines().filter(r => r.id !== id);
                Storage.set('routines', routines);
            }
        };
        
        // ==================== EJERCICIOS PREDEFINIDOS ====================
        
        const defaultExercises = [
            { id: 'bench-press', name: 'Press de Banca', isCustom: false },
            { id: 'squat', name: 'Sentadilla', isCustom: false },
            { id: 'deadlift', name: 'Peso Muerto', isCustom: false },
            { id: 'overhead-press', name: 'Press Militar', isCustom: false },
            { id: 'pull-up', name: 'Dominadas', isCustom: false },
            { id: 'barbell-row', name: 'Remo con Barra', isCustom: false },
            { id: 'dumbbell-curl', name: 'Curl de B√≠ceps', isCustom: false },
            { id: 'tricep-dip', name: 'Fondos de Tr√≠ceps', isCustom: false },
            { id: 'leg-press', name: 'Prensa de Piernas', isCustom: false },
            { id: 'lat-pulldown', name: 'Jal√≥n al Pecho', isCustom: false }
        ];
        
        // ==================== FUNCIONES DE NAVEGACI√ìN ====================
        
        function switchTab(tabName) {
            // Actualizar botones
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Actualizar contenido
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Cargar datos espec√≠ficos
            if (tabName === 'calories') {
                loadCalorieTracker();
            } else if (tabName === 'workouts') {
                loadRoutines();
            } else if (tabName === 'recommendations') {
                loadAmazonProducts();
            }
        }
        
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            
            // Preparar datos seg√∫n el modal
            if (modalId === 'add-meal-modal') {
                populateMealSelect();
            } else if (modalId === 'create-recipe-modal') {
                document.getElementById('recipe-ingredients-list').innerHTML = '';
                addRecipeIngredient();
            } else if (modalId === 'create-routine-modal') {
                document.getElementById('routine-exercises-list').innerHTML = '';
                addExerciseToRoutine();
            }
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        // ==================== CALCULADORA DE CALOR√çAS ====================
        
        function calculateCalories() {
            const age = parseInt(document.getElementById('age').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);
            const gender = document.getElementById('gender').value;
            const activity = parseFloat(document.getElementById('activity').value);
            const goal = parseInt(document.getElementById('goal').value);
            
            if (!age || !weight || !height) {
                alert('Por favor, completa todos los campos');
                return;
            }
            
            // F√≥rmula de Mifflin-St Jeor (la m√°s precisa)
            let bmr;
            if (gender === 'male') {
                bmr = (10 * weight) + (6.25 * height) - (5 * age) + 5;
            } else {
                bmr = (10 * weight) + (6.25 * height) - (5 * age) - 161;
            }
            
            const tdee = bmr * activity;
            const target = tdee + goal;
            
            // Guardar datos del usuario
            Storage.setUserData({
                age, weight, height, gender, activity, goal,
                bmr: Math.round(bmr),
                tdee: Math.round(tdee),
                target: Math.round(target)
            });
            
            // Mostrar resultados
            document.getElementById('bmr-value').textContent = Math.round(bmr);
            document.getElementById('tdee-value').textContent = Math.round(tdee);
            document.getElementById('target-value').textContent = Math.round(target);
            document.getElementById('target-calories').textContent = Math.round(target);
            document.getElementById('calorie-results').style.display = 'block';
            
            updateCalorieProgress();
        }
        
        // ==================== GESTI√ìN DE ALIMENTOS ====================
        
        function createFood() {
            const name = document.getElementById('food-name').value;
            const protein = parseFloat(document.getElementById('food-protein').value) || 0;
            const carbs = parseFloat(document.getElementById('food-carbs').value) || 0;
            const fats = parseFloat(document.getElementById('food-fats').value) || 0;
            
            if (!name) {
                alert('Por favor, ingresa el nombre del alimento');
                return;
            }
            
            // Calcular calor√≠as totales (4 cal/g prote√≠na y carbs, 9 cal/g grasa)
            const calories = (protein * 4) + (carbs * 4) + (fats * 9);
            
            Storage.addFood({
                name,
                protein,
                carbs,
                fats,
                calories,
                type: 'food'
            });
            
            closeModal('create-food-modal');
            document.getElementById('food-name').value = '';
            document.getElementById('food-protein').value = '';
            document.getElementById('food-carbs').value = '';
            document.getElementById('food-fats').value = '';
            
            alert(`Alimento "${name}" creado con √©xito!`);
        }
        
        // ==================== GESTI√ìN DE RECETAS ====================
        
        function addRecipeIngredient() {
            const container = document.getElementById('recipe-ingredients-list');
            const foods = Storage.getFoods();
            
            const ingredientDiv = document.createElement('div');
            ingredientDiv.className = 'form-group';
            ingredientDiv.innerHTML = `
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <select style="flex: 2;" class="recipe-ingredient-select">
                        <option value="">-- Selecciona alimento --</option>
                        ${foods.map(food => `<option value="${food.id}">${food.name}</option>`).join('')}
                    </select>
                    <input type="number" placeholder="Cantidad (g)" style="flex: 1;" class="recipe-ingredient-amount" min="1" value="100">
                    <button type="button" class="btn-danger btn-small" onclick="this.parentElement.parentElement.remove()">√ó</button>
                </div>
            `;
            container.appendChild(ingredientDiv);
        }
        
        function createRecipe() {
            const name = document.getElementById('recipe-name').value;
            const servings = parseInt(document.getElementById('recipe-servings').value) || 1;
            
            if (!name) {
                alert('Por favor, ingresa el nombre de la receta');
                return;
            }
            
            const ingredientSelects = document.querySelectorAll('.recipe-ingredient-select');
            const ingredientAmounts = document.querySelectorAll('.recipe-ingredient-amount');
            
            const ingredients = [];
            const foods = Storage.getFoods();
            
            let totalProtein = 0, totalCarbs = 0, totalFats = 0, totalCalories = 0;
            
            ingredientSelects.forEach((select, index) => {
                const foodId = parseInt(select.value);
                const amount = parseFloat(ingredientAmounts[index].value) || 0;
                
                if (foodId && amount > 0) {
                    const food = foods.find(f => f.id === foodId);
                    if (food) {
                        ingredients.push({ foodId, foodName: food.name, amount });
                        
                        // Calcular macros proporcionales
                        const factor = amount / 100;
                        totalProtein += food.protein * factor;
                        totalCarbs += food.carbs * factor;
                        totalFats += food.fats * factor;
                        totalCalories += food.calories * factor;
                    }
                }
            });
            
            if (ingredients.length === 0) {
                alert('Debes a√±adir al menos un ingrediente');
                return;
            }
            
            // Calcular por porci√≥n
            Storage.addRecipe({
                name,
                servings,
                ingredients,
                protein: totalProtein / servings,
                carbs: totalCarbs / servings,
                fats: totalFats / servings,
                calories: totalCalories / servings,
                type: 'recipe'
            });
            
            closeModal('create-recipe-modal');
            document.getElementById('recipe-name').value = '';
            document.getElementById('recipe-servings').value = '1';
            
            alert(`Receta "${name}" creada con √©xito!`);
        }
        
        // ==================== REGISTRO DE COMIDAS ====================
        
        function populateMealSelect() {
            const select = document.getElementById('meal-select');
            const foods = Storage.getFoods();
            const recipes = Storage.getRecipes();
            
            select.innerHTML = '<option value="">-- Selecciona --</option>';
            
            if (foods.length > 0) {
                select.innerHTML += '<optgroup label="Alimentos">';
                foods.forEach(food => {
                    select.innerHTML += `<option value="food-${food.id}">${food.name} (${Math.round(food.calories)} cal)</option>`;
                });
                select.innerHTML += '</optgroup>';
            }
            
            if (recipes.length > 0) {
                select.innerHTML += '<optgroup label="Recetas">';
                recipes.forEach(recipe => {
                    select.innerHTML += `<option value="recipe-${recipe.id}">${recipe.name} (${Math.round(recipe.calories)} cal/porci√≥n)</option>`;
                });
                select.innerHTML += '</optgroup>';
            }
        }
        
        function addMealToLog() {
            const select = document.getElementById('meal-select').value;
            const quantity = parseFloat(document.getElementById('meal-quantity').value) || 1;
            
            if (!select) {
                alert('Por favor, selecciona un alimento o receta');
                return;
            }
            
            const [type, id] = select.split('-');
            const itemId = parseInt(id);
            
            let item;
            if (type === 'food') {
                item = Storage.getFoods().find(f => f.id === itemId);
            } else {
                item = Storage.getRecipes().find(r => r.id === itemId);
            }
            
            if (item) {
                Storage.addMeal({
                    name: item.name,
                    calories: item.calories * quantity,
                    protein: item.protein * quantity,
                    carbs: item.carbs * quantity,
                    fats: item.fats * quantity,
                    quantity,
                    type: item.type
                });
                
                closeModal('add-meal-modal');
                loadCalorieTracker();
            }
        }
        
        function deleteMeal(id) {
            if (confirm('¬øEliminar esta comida del registro?')) {
                Storage.deleteMeal(id);
                loadCalorieTracker();
            }
        }
        
        function loadCalorieTracker() {
            const meals = Storage.getMeals();
            const container = document.getElementById('meals-log');
            
            if (meals.length === 0) {
                container.innerHTML = '<p style="color: var(--text-muted); text-align: center;">No hay comidas registradas hoy</p>';
            } else {
                container.innerHTML = meals.map(meal => `
                    <div class="meal-log">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div class="item-name">${meal.name}</div>
                                <div class="item-details">
                                    ${Math.round(meal.calories)} cal | 
                                    P: ${Math.round(meal.protein)}g | 
                                    C: ${Math.round(meal.carbs)}g | 
                                    G: ${Math.round(meal.fats)}g
                                    ${meal.quantity !== 1 ? ` | Cantidad: ${meal.quantity}` : ''}
                                </div>
                            </div>
                            <button class="btn-danger btn-small" onclick="deleteMeal(${meal.id})">Eliminar</button>
                        </div>
                    </div>
                `).join('');
            }
            
            updateCalorieProgress();
        }
        
        function updateCalorieProgress() {
            const meals = Storage.getMeals();
            const userData = Storage.getUserData();
            const target = userData.target || 2000;
            
            const consumed = meals.reduce((sum, meal) => sum + meal.calories, 0);
            const percentage = Math.min((consumed / target) * 100, 100);
            
            document.getElementById('consumed-calories').textContent = Math.round(consumed);
            document.getElementById('target-calories').textContent = Math.round(target);
            document.getElementById('calorie-bar').style.width = percentage + '%';
        }
        
        // ==================== GESTI√ìN DE EJERCICIOS ====================
        
        function getAllExercises() {
            return [...defaultExercises, ...Storage.getCustomExercises()];
        }
        
        function createCustomExercise() {
            const name = document.getElementById('custom-exercise-name').value;
            const unit = document.getElementById('custom-exercise-unit').value;
            
            if (!name || !unit) {
                alert('Por favor, completa todos los campos');
                return;
            }
            
            Storage.addCustomExercise({ name, unit });
            
            closeModal('create-exercise-modal');
            document.getElementById('custom-exercise-name').value = '';
            document.getElementById('custom-exercise-unit').value = '';
            
            alert(`Ejercicio "${name}" creado con √©xito!`);
            
            // Refrescar la lista de ejercicios en el modal de rutina si est√° abierto
            if (document.getElementById('create-routine-modal').classList.contains('active')) {
                const exerciseLists = document.querySelectorAll('.routine-exercise-select');
                exerciseLists.forEach(select => populateExerciseSelect(select));
            }
        }
        
        function populateExerciseSelect(selectElement) {
            const exercises = getAllExercises();
            selectElement.innerHTML = `
                <option value="">-- Selecciona ejercicio --</option>
                <option value="create-new">‚ûï Crear ejercicio personalizado</option>
                ${exercises.map(ex => `<option value="${ex.id}">${ex.name}${ex.isCustom ? ' (personalizado)' : ''}</option>`).join('')}
            `;
        }
        
        function addExerciseToRoutine() {
            const container = document.getElementById('routine-exercises-list');
            const exerciseDiv = document.createElement('div');
            exerciseDiv.className = 'card';
            exerciseDiv.style.marginBottom = '15px';
            
            exerciseDiv.innerHTML = `
                <div class="form-group">
                    <label>Ejercicio</label>
                    <select class="routine-exercise-select" onchange="handleExerciseChange(this)">
                        <option value="">-- Selecciona ejercicio --</option>
                    </select>
                </div>
                <div class="exercise-details" style="display: none;">
                    <div class="form-group">
                        <label>N√∫mero de Series</label>
                        <input type="number" class="exercise-sets" min="1" value="3" onchange="generateSetsInputs(this)">
                    </div>
                    <div class="sets-container"></div>
                </div>
                <button type="button" class="btn-danger" onclick="this.parentElement.remove()">Eliminar Ejercicio</button>
            `;
            
            container.appendChild(exerciseDiv);
            populateExerciseSelect(exerciseDiv.querySelector('.routine-exercise-select'));
        }
        
        function handleExerciseChange(selectElement) {
            if (selectElement.value === 'create-new') {
                openModal('create-exercise-modal');
                selectElement.value = '';
                return;
            }
            
            const detailsDiv = selectElement.closest('.card').querySelector('.exercise-details');
            if (selectElement.value) {
                detailsDiv.style.display = 'block';
                generateSetsInputs(selectElement.closest('.card').querySelector('.exercise-sets'));
            } else {
                detailsDiv.style.display = 'none';
            }
        }
        
        function generateSetsInputs(setsInput) {
            const card = setsInput.closest('.card');
            const container = card.querySelector('.sets-container');
            const numSets = parseInt(setsInput.value) || 0;
            const exerciseId = card.querySelector('.routine-exercise-select').value;
            const exercise = getAllExercises().find(e => e.id === exerciseId);
            
            container.innerHTML = '';
            
            for (let i = 1; i <= numSets; i++) {
                const setDiv = document.createElement('div');
                setDiv.className = 'exercise-set';
                
                if (exercise && exercise.isCustom) {
                    setDiv.innerHTML = `
                        <label>Serie ${i}</label>
                        <input type="number" placeholder="${exercise.unit}" class="set-measure" style="width: 100%; margin-top: 5px;">
                    `;
                } else {
                    setDiv.innerHTML = `
                        <label>Serie ${i}</label>
                        <div style="display: flex; gap: 10px; margin-top: 5px;">
                            <input type="number" placeholder="Peso (kg)" class="set-weight" style="flex: 1;">
                            <input type="number" placeholder="Repeticiones" class="set-reps" style="flex: 1;">
                        </div>
                    `;
                }
                
                container.appendChild(setDiv);
            }
        }
        
        // ==================== GESTI√ìN DE RUTINAS ====================
        
        function createRoutine() {
            const name = document.getElementById('routine-name').value;
            
            if (!name) {
                alert('Por favor, ingresa el nombre de la rutina');
                return;
            }
            
            const exerciseCards = document.querySelectorAll('#routine-exercises-list .card');
            const exercises = [];
            
            exerciseCards.forEach(card => {
                const exerciseId = card.querySelector('.routine-exercise-select').value;
                if (!exerciseId) return;
                
                const exercise = getAllExercises().find(e => e.id === exerciseId);
                const numSets = parseInt(card.querySelector('.exercise-sets').value) || 0;
                const sets = [];
                
                if (exercise.isCustom) {
                    const measures = card.querySelectorAll('.set-measure');
                    measures.forEach((input, idx) => {
                        const measure = parseFloat(input.value) || 0;
                        sets.push({ setNumber: idx + 1, measure });
                    });
                } else {
                    const weights = card.querySelectorAll('.set-weight');
                    const reps = card.querySelectorAll('.set-reps');
                    
                    weights.forEach((weightInput, idx) => {
                        const weight = parseFloat(weightInput.value) || 0;
                        const repetitions = parseInt(reps[idx].value) || 0;
                        sets.push({ setNumber: idx + 1, weight, reps: repetitions });
                    });
                }
                
                if (sets.length > 0) {
                    exercises.push({
                        exerciseId,
                        exerciseName: exercise.name,
                        isCustom: exercise.isCustom,
                        unit: exercise.unit,
                        sets
                    });
                }
            });
            
            if (exercises.length === 0) {
                alert('Debes a√±adir al menos un ejercicio con series completas');
                return;
            }
            
            Storage.addRoutine({ name, exercises });
            
            closeModal('create-routine-modal');
            document.getElementById('routine-name').value = '';
            loadRoutines();
            
            alert(`Rutina "${name}" creada con √©xito!`);
        }
        
        function loadRoutines() {
            const routines = Storage.getRoutines();
            const container = document.getElementById('routines-list');
            
            if (routines.length === 0) {
                container.innerHTML = '<p style="color: var(--text-muted); text-align: center;">No hay rutinas creadas</p>';
            } else {
                container.innerHTML = routines.map(routine => `
                    <div class="item">
                        <div class="item-info">
                            <div class="item-name">${routine.name}</div>
                            <div class="item-details">${routine.exercises.length} ejercicios</div>
                        </div>
                        <div class="item-actions">
                            <button class="btn-secondary btn-small" onclick="viewRoutine(${routine.id})">Ver Detalles</button>
                            <button class="btn-danger btn-small" onclick="deleteRoutine(${routine.id})">Eliminar</button>
                        </div>
                    </div>
                `).join('');
            }
        }
        
        function viewRoutine(id) {
            const routine = Storage.getRoutines().find(r => r.id === id);
            if (!routine) return;
            
            document.getElementById('view-routine-title').textContent = routine.name;
            
            const content = routine.exercises.map((exercise, exIdx) => `
                <div class="card" style="margin-bottom: 15px;">
                    <h4 style="color: var(--secondary); margin-bottom: 10px;">${exercise.exerciseName}</h4>
                    ${exercise.sets.map(set => `
                        <div class="exercise-set">
                            <strong>Serie ${set.setNumber}:</strong>
                            ${exercise.isCustom 
                                ? `${set.measure} ${exercise.unit}` 
                                : `${set.weight} kg √ó ${set.reps} reps`
                            }
                        </div>
                    `).join('')}
                    <div style="margin-top: 15px;">
                        <button class="btn-secondary btn-small" onclick="editExercise(${id}, ${exIdx})">Editar</button>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('view-routine-content').innerHTML = content;
            openModal('view-routine-modal');
        }
        
        function editExercise(routineId, exerciseIdx) {
            const routine = Storage.getRoutines().find(r => r.id === routineId);
            const exercise = routine.exercises[exerciseIdx];
            
            const newSets = [];
            exercise.sets.forEach((set, idx) => {
                if (exercise.isCustom) {
                    const newMeasure = prompt(`Serie ${idx + 1} - Ingresa ${exercise.unit}:`, set.measure);
                    if (newMeasure !== null) {
                        newSets.push({ setNumber: idx + 1, measure: parseFloat(newMeasure) || 0 });
                    }
                } else {
                    const newWeight = prompt(`Serie ${idx + 1} - Peso (kg):`, set.weight);
                    const newReps = prompt(`Serie ${idx + 1} - Repeticiones:`, set.reps);
                    if (newWeight !== null && newReps !== null) {
                        newSets.push({ 
                            setNumber: idx + 1, 
                            weight: parseFloat(newWeight) || 0, 
                            reps: parseInt(newReps) || 0 
                        });
                    }
                }
            });
            
            routine.exercises[exerciseIdx].sets = newSets;
            Storage.updateRoutine(routineId, routine);
            viewRoutine(routineId);
        }
        
        function deleteRoutine(id) {
            if (confirm('¬øEliminar esta rutina?')) {
                Storage.deleteRoutine(id);
                loadRoutines();
            }
        }
        
        // ==================== RECOMENDACIONES DE AMAZON ====================
        
        function loadAmazonProducts() {
            const products = [
                { 
                    name: 'Mancuernas Ajustables', 
                    icon: 'üèãÔ∏è',
                    search: 'mancuernas+ajustables'
                },
                { 
                    name: 'Esterilla de Yoga', 
                    icon: 'üßò',
                    search: 'esterilla+yoga'
                },
                { 
                    name: 'Bandas de Resistencia', 
                    icon: 'üí™',
                    search: 'bandas+resistencia+fitness'
                },
                { 
                    name: 'Prote√≠na Whey', 
                    icon: 'ü•§',
                    search: 'proteina+whey'
                },
                { 
                    name: 'Pulsera de Actividad', 
                    icon: '‚åö',
                    search: 'pulsera+actividad+fitness'
                },
                { 
                    name: 'Barra de Dominadas', 
                    icon: 'üö™',
                    search: 'barra+dominadas'
                },
                { 
                    name: 'Zapatillas Running', 
                    icon: 'üëü',
                    search: 'zapatillas+running'
                },
                { 
                    name: 'Rodillo de Espuma', 
                    icon: 'üîµ',
                    search: 'rodillo+espuma+foam+roller'
                },
                { 
                    name: 'B√°scula Inteligente', 
                    icon: '‚öñÔ∏è',
                    search: 'bascula+inteligente+fitness'
                },
                { 
                    name: 'Cuerda de Saltar', 
                    icon: 'ü™¢',
                    search: 'cuerda+saltar+fitness'
                },
                { 
                    name: 'Guantes de Gimnasio', 
                    icon: 'üß§',
                    search: 'guantes+gimnasio'
                },
                { 
                    name: 'Botella Deportiva', 
                    icon: 'üßÉ',
                    search: 'botella+agua+deporte'
                }
            ];
            
            const container = document.getElementById('amazon-products');
            container.innerHTML = products.map(product => `
                <a href="https://www.amazon.es/s?k=${product.search}&tag=fitness-21" 
                   target="_blank" 
                   rel="noopener noreferrer" 
                   class="amazon-product">
                    <div class="amazon-icon">${product.icon}</div>
                    <h4>${product.name}</h4>
                    <p style="color: var(--text-muted); font-size: 0.9rem;">Ver en Amazon ‚Üí</p>
                </a>
            `).join('');
        }
        
        // ==================== INICIALIZACI√ìN ====================
        
        document.addEventListener('DOMContentLoaded', () => {
            loadCalorieTracker();
            
            // Cargar datos del usuario si existen
            const userData = Storage.getUserData();
            if (userData.target) {
                document.getElementById('age').value = userData.age || '';
                document.getElementById('weight').value = userData.weight || '';
                document.getElementById('height').value = userData.height || '';
                document.getElementById('gender').value = userData.gender || 'male';
                document.getElementById('activity').value = userData.activity || '1.2';
                document.getElementById('goal').value = userData.goal || '0';
                
                document.getElementById('bmr-value').textContent = userData.bmr;
                document.getElementById('tdee-value').textContent = userData.tdee;
                document.getElementById('target-value').textContent = userData.target;
                document.getElementById('target-calories').textContent = userData.target;
                document.getElementById('calorie-results').style.display = 'block';
                
                updateCalorieProgress();
            }
        });
    </script>
</body>
</html>
